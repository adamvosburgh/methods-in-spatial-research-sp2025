{"componentChunkName":"component---src-pages-resources-mdx-slug-js","path":"/resources/8-street-view/","result":{"data":{"mdx":{"frontmatter":{"title":"Making Data from Street View"},"body":"var _excluded = [\"components\"];\nfunction _extends() { return _extends = Object.assign ? Object.assign.bind() : function (n) { for (var e = 1; e < arguments.length; e++) { var t = arguments[e]; for (var r in t) ({}).hasOwnProperty.call(t, r) && (n[r] = t[r]); } return n; }, _extends.apply(null, arguments); }\nfunction _objectWithoutProperties(e, t) { if (null == e) return {}; var o, r, i = _objectWithoutPropertiesLoose(e, t); if (Object.getOwnPropertySymbols) { var s = Object.getOwnPropertySymbols(e); for (r = 0; r < s.length; r++) o = s[r], t.includes(o) || {}.propertyIsEnumerable.call(e, o) && (i[o] = e[o]); } return i; }\nfunction _objectWithoutPropertiesLoose(r, e) { if (null == r) return {}; var t = {}; for (var n in r) if ({}.hasOwnProperty.call(r, n)) { if (e.includes(n)) continue; t[n] = r[n]; } return t; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Making Data from Street View\",\n  \"date\": \"2024-03-09\",\n  \"author\": \"Adam Vosburgh\",\n  \"sequence\": 8,\n  \"cat\": \"tutorial\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h2\", null, \"Street View Static Maps API\"), mdx(\"p\", null, \"This is a brief guide to using the Street View Static Maps API (Application Programming Interface). In here we will use an example python script to download images through the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/maps/documentation/streetview/overview\"\n  }, \"Google Street View Static Maps API\"), \".\"), mdx(\"p\", null, \"This script is a modified version of the one used for \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://centerforspatialresearch.github.io/methods-in-spatial-research-sp2024/tutorials/aerial-imagery\"\n  }, \"Tutorial 7 - Making Data from Aerial Imagery\"), \". Using this script, you can make work with street view imagery similar to Josh Begley's \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://theintercept.co/officer-involved/\"\n  }, \"Officer Involved\"), \".\"), mdx(\"p\", null, \"Just like Tutorial 7, this tutorial is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" an introduction to APIs, \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"nor\"), \" is it an introduction to Python. The tutorial walks you through how to batch download imagery using a CSV file of latitude and lognitude coordinates, and specify some parameters relevant to the way that Google collects are makes this data available. While the product is raster images, these are not geospatial rasters - they are not georeferenced, and do not ahve embedded geographic information.\"), mdx(\"p\", null, \"At a high level the process is much the same as the previous tutorial: the python script processes your CSV file into an API query - essentially a URL. \"), mdx(\"p\", null, \"The outputs are image files (.png) that are not georeferenced and thus are best suited to use outside of a GIS software -- combined into grids, assembled for an animation or GIF \"), mdx(\"h2\", null, \"Instructions\"), mdx(\"h3\", null, \"Prerequisites\"), mdx(\"p\", null, \"Follow instructions for how to create a Google API key for the Static Maps API \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/maps/documentation/streetview/get-api-key\"\n  }, \"here\"), \". You must enable billing for your API key in order to run the script, you will not incur any charges for the scale of project outlined in this tutorial. Every Google SKU account is granted $200 per month in credits towards API usage, this translates to being able to download 100,000 images from Google's Static Maps API for free each month. For more information on pricing see \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://developers.google.com/maps/documentation/maps-static/usage-and-billing\"\n  }, \"this page\"), \".\"), mdx(\"p\", null, \"Important to mention here is to keep your API key a secret - if someone else obtains it, they could run up a massive bill. What this means in effect, is you should never post questions to online forums like stack exchange using your API key, and if you ever store code like this in a github reposity, you should hide your API key. There are endless ways to do this, but here is \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://stackoverflow.com/questions/44342276/how-to-push-code-to-github-hiding-the-api-keys\"\n  }, \"one\"), \". You do not need to worry about this for this tutorial, as we are not sharing this code anywhere.\"), mdx(\"h3\", null, \"Step 0: Google colab\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Whereas Tutorial 7 introduced methods to do this both on colab and on your local computer, for brevity's sake I will just do the former here. If you prefer not to use google services or to be able to run this without an internet connection, please cite \", mdx(\"a\", {\n    parentName: \"strong\",\n    \"href\": \"https://centerforspatialresearch.github.io/methods-in-spatial-research-sp2024/tutorials/aerial-imagery\"\n  }, \"Tutorial 7\"))), mdx(\"p\", null, \"Launch \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://colab.research.google.com/\"\n  }, \"Google Colab\"), \". This is a cloud-based programming environment that allows for the execution of Python code in the browser.\"), mdx(\"h3\", null, \"Step 1 - formatting a csv file with latitude and longitude coordinates\"), mdx(\"p\", null, \"The script below expects a CSV file in a specific format, with three columns, no headers/column names, column 1 contains a unique id for each point, column 2 contains latitude coordinates, column 3 contains longitude coordinates. A sample of five points are shown below.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"304388,40.80217804,-73.94811558\\n523465,40.80582444,-73.96823242\\n178559,40.80821953,-73.95643891999998\\n523459,40.8055583,-73.96837025\\n523532,40.80871886,-73.96616471\\n\")), mdx(\"p\", null, \"These five points are borrowed from the 2015 Street Tree Census that we used in Tutorial 1. This specifically is a subset of that dataset, showing just the five largest trees of that sample that I filtered using the python library pandas (which is also used in this tutorial). The three columns in this dataset are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"tree_id\"), \", \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"latitude\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"longitude\"), \". \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://drive.google.com/open?id=1ZpLafJbA2xRxJ55J8B4DsAveZBNSzUUD&usp=drive_fs\"\n  }, \"Here\"), \" is the full csv from tutorial 1, if you are curious about what the snippet of python looked like to get that five thickest trees, I will include that below.\"), mdx(\"p\", null, \"Save that snippet above as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"StreetView_test_points.csv\"), \", or grab points of latitude/longitude of your own choosing (and in this case likely make the first column an index of 0,1,2 etc). You can do either by either pasting the text above into a text editor (making sure it is in plain text mode) and save it as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"StreetView_test_points.csv\"), \". Or you can use some spreadsheet software (google sheets, or excel) and create a table with three columns containing the values above and save it as a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \".csv\"), \" file. When you reuse this script on you own you will likely be using latitude and longitude coordinates gathered from elsewhere -- you may export them from QGIS, or from EpiCollect, or manually input them into a spreadsheet. Before uploading them here be sure to format them exactly as shown above (usually by removing the headers). \"), mdx(\"h3\", null, \"Step 2 - Setting up Colab and uploading the csv file\"), mdx(\"p\", null, \"Open a new Google Colab notebook. This is the environment you will use to run the Python script which will query the Google Static Maps API.  \"), mdx(\"p\", null, \"First you will import necessary modules and use the colab data uploader to add your csv file to the notebook. To accomplish this run the following code in the first cell of your notebook (copy and paste the code then click the play button next to the cell to run):\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"from google.colab import files\\nimport io\\nimport pandas as pd\\n\\n# upload data\\nuploaded = files.upload()\\nfor fn in uploaded.keys():\\n  print('User uploaded file \\\"{name}\\\" with length {length} bytes'.format(\\n      name=fn, length=len(uploaded[fn])))\\n\")), mdx(\"p\", null, \"Use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Choose Files\"), \" button that appears to navigate to the 'StreetView_test_points.csv' file that you have just created. \"), mdx(\"h3\", null, \"Step 2.5 - Editing Street Tree dataset\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \" You do not need to do this step, this is only here if you are curious to how I filtered the example dataset \")), mdx(\"p\", null, \"As written above, my sample of five points is the five largest trees in the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://drive.google.com/open?id=1ZpLafJbA2xRxJ55J8B4DsAveZBNSzUUD&usp=drive_fs\"\n  }, \"sample of the 2015 Street Tree Survey\"), \" that we used in Tutorial 1. If you are modifying this with a different dataset, make sure to upload that dataset csv in the previous step (instead of StreetView_test_points) first. After you do that, uploading the result file again to use in the next stages.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"df_StreetTrees = pd.read_csv(\\\"/content/2015_Street_Tree_Census_subset_um.csv\\\")\\n\\n# Filter for the 5 largest values in 'tree_dbh'\\ndf_StreetTreesFilter = df_StreetTrees.nlargest(5, 'tree_dbh')\\n\\n# Specify columns to keep in the dataset to download\\ncolumns_to_keep = ['tree_id', 'latitude', \\\"longitude\\\"]\\n\\n# Keep only the specified columns\\ndf_download = df_StreetTreesFilter[columns_to_keep]\\n\\ndf_download.to_csv(\\\"/content/StreetView_test_points.csv\\\", header=False, index=False)\\n\")), mdx(\"p\", null, \"This will enable us to visualize the largest street trees in our sample. However, a downside here is that we do not know where we should point the street view camera to accurately capture the specific tree. There are ways to figure that out, but be aware of the limitations inherent in this API.\"), mdx(\"h3\", null, \"Step 3 - Define and run Python function to query API\"), mdx(\"p\", null, \"Unlike the Static Maps API, the Street View API does not necessarily produce imagery form an exact point. What it does is it looks for a captured panorama image \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"near\"), \" the location that you provide it. From there, it has additional parameters that let you define what part of the panoramic image you want to download. Below is a summary of those. While these parameters are not required to run the API, I have written the function with them, in order to make it easier for you to edit them to values of your liking: \"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"heading\"), \" - if not provided defaults directionality of photo. 0 or 360 equal North, 90 East\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"fov\"), \" - Field of View in Degrees. Default is 90\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"pitch\"), \" - Up or down angle of camera relative to vehicle. Default is 0, 90 is straight up, -90 straight down.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"radius\"), \" - Sets a radius from provided coordinate point to search for imagery. In meters. Default is 50.\")), mdx(\"p\", null, \"In the next cell of your notebook copy the following script, and run it. It defines a function to download street view images based on input parameters, that it then transforms into an API Query, which is essentially a URL.:\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"copy this exactly and run it, do not chance anything !\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"# required modules\\nimport requests\\nimport csv\\nfrom io import open as iopen\\n\\n# functions needed\\ndef locationreader(uploaded_filename):\\n  df = pd.read_csv(io.BytesIO(uploaded[uploaded_filename]), names=['id','lat','lng'])\\n  list_df = df.values.tolist()\\n  return(list_df)\\n\\n# defining a function, it takes four parameters:\\n# the path to a csv file containing lat/lon coordinates\\n# your API key\\n# the zoom level you would your images to be downloaded as\\n# the size, in pixels of your images, the maximum is 640\\n# unless you have signed up for a premium account\\n\\ndef street_view_colab(uploaded_filename,APIkey,heading,fov,pitch,radius,size):\\n    API_KEY = APIkey\\n    Heading = heading\\n    Fov = fov\\n    Pitch = pitch\\n    Radius = radius\\n    base = \\\"https://maps.googleapis.com/maps/api/streetview?size=\\\"\\n    # this section reads the csv file\\n    locations = locationreader(uploaded_filename)\\n\\n    # here we format a url to pass to the API for each row in the csv file\\n    for location in locations:\\n        id, lat, lng = location\\n        latlng = \\\"location={},{}\\\".format(lat, lng)\\n        fovValue = \\\"fov={}\\\".format(Fov)\\n        headingValue = \\\"heading={}\\\".format(Heading)\\n        pitchValue = \\\"pitch={}\\\".format(Pitch)\\n        radiusValue = \\\"radius={}\\\".format(Radius)\\n        keys = \\\"key={}\\\".format(API_KEY)\\n        url = \\\"{}{}x{}&{}&{}&{}&{}&{}&{}\\\".format(base,size,size,latlng,fovValue,headingValue,pitchValue,radiusValue,keys)\\n        # defining the name for the image files that will be downloaded\\n        filename = \\\"{}.png\\\".format(id)\\n        print(url)\\n        res = requests.get(url)\\n        if res.status_code == requests.codes.ok:\\n            with iopen(filename, 'wb') as file:\\n                file.write(res.content)\\n            files.download(filename)\\n            print(filename)\\n        #here we tell the function to show us an error message if it is unable to download an image\\n        else:\\n            print(res.status_code)\\n            print(url)\\n            return False\\n\")), mdx(\"h3\", null, \"Step 4 - Run the function to download your images\"), mdx(\"p\", null, \"Once you have defined the function above, call the function to download images. Replace the parameters in quotations with the name of the csv file you uploaded and your API key (both need to be enclosed in \\\" \\\"). \"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-python\"\n  }, \"street_view_colab(\\\"StreetView_test_points.csv\\\",\\\"yourAPIkey\\\",0,90,0,50,640)\\n\")), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"make sure you use the snippet above and not the code from step 3.\")), mdx(\"p\", null, \"The last five numbers, define the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"heading\"), \", field of view (\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"fov\"), \"), \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"pitch\"), \", and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"radius\"), \" that the funciton will query the API in. What is essentially happening here is we simply providing the parameters that will go into a URL that makes up an API query. For a breakdown of what is what, see the image below.\"), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"800px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"21.999999999999996%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAIAAAABPYjBAAAACXBIWXMAAC4jAAAuIwF4pT92AAAAn0lEQVQI103N2w6DIBBFUf//H02FoqBUEDsUhts00rTpejsPO2cgotYaALju7I6LO/YVThMC7ntVKhuL8emy9z761hoRDdSllF5d6hARwIcQS8khVK1pW4N7WDxMBDjwbPQXf/5zzumrlILeJG/6ijljKhgrllp+yRUDgLVWa80Yk1IKIcZxFOLO2W2appnzWQjBJyW3ZVkW5ZUiY674DQSZ5Q6lp1G/AAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"URL diagram\",\n    \"title\": \"URL diagram\",\n    \"src\": \"/static/e0c7e25696054a896502d5276ee52322/5a190/street_view_url.png\",\n    \"srcSet\": [\"/static/e0c7e25696054a896502d5276ee52322/772e8/street_view_url.png 200w\", \"/static/e0c7e25696054a896502d5276ee52322/e17e5/street_view_url.png 400w\", \"/static/e0c7e25696054a896502d5276ee52322/5a190/street_view_url.png 800w\", \"/static/e0c7e25696054a896502d5276ee52322/c1b63/street_view_url.png 1200w\", \"/static/e0c7e25696054a896502d5276ee52322/29007/street_view_url.png 1600w\", \"/static/e0c7e25696054a896502d5276ee52322/3582a/street_view_url.png 2925w\"],\n    \"sizes\": \"(max-width: 800px) 100vw, 800px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \")), mdx(\"p\", null, \"You should see the names of the images print in your notebook and images for the latitude and longitude coordinates specified in your csv file will begin to download to the downloads folder of your computer.\"), mdx(\"p\", null, \"If you did not change anything in the above script, you will notice that the images you download all point directly north. Querying static images from an API that queries panoramas means that you have to think about where the camera is in relation to the objects or phenomena that you want to capture.\"), mdx(\"h2\", null, \"Challenge\"), mdx(\"p\", null, \"Use the Google Street View Static API to download street view images for 20 - 100 significant locations of your choosing.\"), mdx(\"p\", null, \"Design a layout to present the images on one or more slides (or GIFs)\"), mdx(\"hr\", null), mdx(\"p\", null, \"Module by Adam Vosburgh, spring 2024.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"8dc5d9e9-01d7-5c93-a967-897e5d75c3b3","slug":"8-street-view","__params":{"slug":"8-street-view"}}},"staticQueryHashes":["3159585216"]}